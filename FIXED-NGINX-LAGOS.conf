# Fixed Lagos State Configuration - No Redirect Loop
# Add this to your Nginx config

location /state/lagos/ {
    # Proxy to Lagos portal
    proxy_pass https://lagos.lgpoa.ng/;
    
    # SSL settings
    proxy_ssl_server_name on;
    proxy_ssl_verify off;
    proxy_http_version 1.1;
    
    # Headers
    proxy_set_header Host lagos.lgpoa.ng;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    
    # Cookie handling
    proxy_cookie_domain lagos.lgpoa.ng $host;
    proxy_cookie_path / /;
    
    # IMPORTANT: Only ONE redirect rule to prevent loops
    proxy_redirect ~^https://lagos\.lgpoa\.ng(.*)$ /state/lagos$1;
    
    # Timeouts
    proxy_read_timeout 300s;
    proxy_connect_timeout 300s;
    proxy_send_timeout 300s;
    
    # Buffer settings
    proxy_buffering off;
    proxy_request_buffering off;
    client_body_buffer_size 128k;
}
